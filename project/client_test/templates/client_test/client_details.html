{% extends "client_test/base.html" %}
{% block content %}
<style>
    .headerSortUp {
        background: url(http://tablesorter.com/themes/blue/asc.gif) no-repeat 99%;
    }
    .headerSortDown {
        background: url(http://tablesorter.com/themes/blue/desc.gif) no-repeat 99%;
    }

</style>
<div class="container">
    {% if messages %}
        <div class="messages alert alert-success">
            {% for message in messages %}
            <p{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}
    <div id="Message">
        <p></p>
    </div>
    <div class="well well-sm">
        <h3>Client Details</h3>
    </div>
    <div>
        <div>
            <div style="width: 120px;float: right;">

                <a href="{% url 'client_test:user_new' %}" data-toggle="modal" data-target="#myModal"
                   style="color:white;" class="btn btn-primary js-add-button">
                    <span class="glyphicon glyphicon-plus"></span> Add User</a>


            </div>
            <br>
            <form action="{% url 'client_test:client_details' %}" method="post">
                {% csrf_token %}
                <div class="input-group" style="width: 500px;float: left;bottom: 20px;height: 10px;">
                    <input type="text" class="form-control"
                           placeholder="Enter username, email, suburb or phone number...." name="value_placeholder">
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <br>
    <table class="table tablesorter" id="myTable">
        <thead >
        <tr>
            <th >Unique Name </th>
            <th >Full Name </th>
            <th >Email </th>
            <th >Phone Number </th>
            <th >Address </th>
            <th >Postal </th>
            <th >State </th>
        </tr>
        </thead>
        <tbody>
        {% for details in client_details %}
        <tr>
            <td>{{ details.client_name }}</td>
            <td class="align-middle">{{ details.contact_name }}</td>
            <td class="align-middle">{{ details.email_address }}</td>
            <td class="align-middle">{{ details.phone_number }}</td>
            <td class="align-middle">{{ details.street_name }} , {{ details.suburb }}</td>
            <td class="align-middle">{{ details.postcode }}</td>
            <td class="align-middle">{{ details.state }}</td>
            <td class="align-middle">
                <a href="{% url 'client_test:update_user' pk=details.pk %}" data-toggle="tooltip" title="Click to Edit">
                    <span class="glyphicon glyphicon-edit"></span>
                </a>
            </td>
            <td class="align-middle">
                <a href="{% url 'client_test:delete_user' pk=details.pk %}" data-toggle="tooltip" title="Delete">
                    <span class="glyphicon glyphicon-trash"></span>
                </a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% if client_details.has_other_pages %}
    <ul class="pagination">
        {% if client_details.has_previous %}
        <li><a href="?page={{ client_details.previous_page_number }}">&laquo;</a></li>
        {% else %}
        <li class="disabled"><span>&laquo;</span></li>
        {% endif %}
        {% for i in client_details.paginator.page_range %}
        {% if client_details.number == i %}
        <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
        {% else %}
        <li><a href="?page={{ i }}">{{ i }}</a></li>
        {% endif %}
        {% endfor %}
        {% if client_details.has_next %}
        <li><a href="?page={{ client_details.next_page_number }}">&raquo;</a></li>
        {% else %}
        <li class="disabled"><span>&raquo;</span></li>
        {% endif %}
    </ul>
    {% endif %}
</div>

<script>
  $(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
    $("#myTable").tablesorter();
    $("table th").addClass("headerSortUp");

    if(localStorage.getItem("Status"))
    {
        $("#Message").addClass("alert alert-success");
        $("#Message").html("User Added Successfully.");
        localStorage.clear();
    }
});

    $(".js-add-button").on("click", function(event){

        $.ajax({
            url: '{% url 'client_test:user_new' %}',
            type: 'get',
            dataType: 'json',
            success: function(data){
                $("#myModal .modal-dialog").html(data['html_form'])

                $("#myForm").on("submit", function(event){
                    event.preventDefault();
                    var form = $(this);
                    $.ajax({
                        url: '{% url 'client_test:user_new' %}',
                        type: 'post',
                        data: form.serialize(),
                        dataType: 'json',
                        success: function(data){
                            if(data['form_is_valid'] = "False")
                            {
                                $("#myModal .modal-dialog").html(data['html_form'])

                            }
                        },
                        error: function(error){

                            if(error.status == 200)
                            {
                                localStorage.setItem("Status","True")
                                location.reload();

                            }
                            else
                            {
                                $("#Message").addClass("alert alert-danger");
                                $("#Message").html("An Error Occured", error);
                            }
                        }
                    });
                });



            },
            error: function(error){
                console.log("modal",error);
                $("#Message").addClass("alert alert-danger");
                $("#Message").html("An Error Occured", error);
            }
        });
    });



</script>

<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->

  </div>
</div>
</body>
{% endblock %}
